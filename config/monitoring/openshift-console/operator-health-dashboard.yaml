# OpenShift Console Dashboard: Operator Health Overview
# Based on ADR-021: OpenShift-Native Dashboard Strategy
apiVersion: v1
kind: ConfigMap
metadata:
  name: jupyter-notebook-validator-operator-health
  namespace: openshift-config-managed
  labels:
    console.openshift.io/dashboard: "true"
    console.openshift.io/odc-dashboard: "true"
    app.kubernetes.io/name: jupyter-notebook-validator-operator
    app.kubernetes.io/component: observability
data:
  operator-health.json: |
    {
      "dashboard": {
        "title": "Jupyter Notebook Validator - Operator Health",
        "tags": ["jupyter", "mlops", "operator"],
        "panels": [
          {
            "title": "Reconciliation Duration (p50, p95, p99)",
            "type": "graph",
            "targets": [
              {
                "expr": "histogram_quantile(0.50, sum(rate(notebookvalidationjob_reconciliation_duration_seconds_bucket[5m])) by (le))",
                "legendFormat": "p50"
              },
              {
                "expr": "histogram_quantile(0.95, sum(rate(notebookvalidationjob_reconciliation_duration_seconds_bucket[5m])) by (le))",
                "legendFormat": "p95"
              },
              {
                "expr": "histogram_quantile(0.99, sum(rate(notebookvalidationjob_reconciliation_duration_seconds_bucket[5m])) by (le))",
                "legendFormat": "p99"
              }
            ]
          },
          {
            "title": "Validation Success Rate",
            "type": "singlestat",
            "targets": [
              {
                "expr": "sum(rate(notebookvalidationjob_validations_total{status=\"succeeded\"}[5m])) / sum(rate(notebookvalidationjob_validations_total[5m])) * 100"
              }
            ],
            "format": "percent",
            "thresholds": "80,95"
          },
          {
            "title": "Active Validation Pods",
            "type": "singlestat",
            "targets": [
              {
                "expr": "sum(notebookvalidationjob_active_pods)"
              }
            ],
            "format": "short",
            "thresholds": "10,20"
          },
          {
            "title": "Error Rate by Type",
            "type": "graph",
            "targets": [
              {
                "expr": "sum(rate(notebookvalidationjob_reconciliation_errors_total[5m])) by (error_type)",
                "legendFormat": "{{error_type}}"
              }
            ]
          },
          {
            "title": "Reconciliation Errors (24h)",
            "type": "singlestat",
            "targets": [
              {
                "expr": "sum(increase(notebookvalidationjob_reconciliation_errors_total[24h]))"
              }
            ],
            "format": "short",
            "colorBackground": true,
            "thresholds": "10,50"
          },
          {
            "title": "Pod Creation Success Rate",
            "type": "singlestat",
            "targets": [
              {
                "expr": "sum(rate(notebookvalidationjob_pod_creations_total{result=\"success\"}[5m])) / sum(rate(notebookvalidationjob_pod_creations_total[5m])) * 100"
              }
            ],
            "format": "percent",
            "thresholds": "90,98"
          },
          {
            "title": "Validation Jobs by Status (5m rate)",
            "type": "graph",
            "targets": [
              {
                "expr": "sum(rate(notebookvalidationjob_validations_total[5m])) by (status)",
                "legendFormat": "{{status}}"
              }
            ]
          },
          {
            "title": "Active Pods by Phase",
            "type": "graph",
            "targets": [
              {
                "expr": "sum(notebookvalidationjob_active_pods) by (phase)",
                "legendFormat": "{{phase}}"
              }
            ]
          },
          {
            "title": "Reconciliation Duration by Namespace (p95)",
            "type": "graph",
            "targets": [
              {
                "expr": "histogram_quantile(0.95, sum(rate(notebookvalidationjob_reconciliation_duration_seconds_bucket[5m])) by (le, namespace))",
                "legendFormat": "{{namespace}}"
              }
            ]
          },
          {
            "title": "Total Validations (24h)",
            "type": "singlestat",
            "targets": [
              {
                "expr": "sum(increase(notebookvalidationjob_validations_total[24h]))"
              }
            ],
            "format": "short",
            "colorBackground": false
          }
        ]
      }
    }

