apiVersion: mlops.mlops.dev/v1alpha1
kind: NotebookValidationJob
metadata:
  name: tier5-ml-training-volumes
  namespace: jupyter-validator-volume-test
spec:
  notebook:
    git:
      url: "https://github.com/tosin2013/jupyter-notebook-validator-test-notebooks.git"
      ref: "main"
      credentialsSecret: "git-credentials"
    path: "notebooks/tier5-volumes/01-ml-training-pipeline-volumes.ipynb"
  
  podConfig:
    containerImage: "quay.io/jupyter/scipy-notebook:latest"
    serviceAccountName: "notebook-validator-jupyter-notebook-validator-runner"
    
    resources:
      requests:
        memory: "1Gi"
        cpu: "1000m"
      limits:
        memory: "2Gi"
        cpu: "2000m"
    
    # Volume configuration for ML training pipeline
    volumes:
      # Shared datasets PVC (read-only)
      - name: shared-datasets
        persistentVolumeClaim:
          claimName: shared-datasets-pvc
          readOnly: true
      
      # Trained models PVC (read-write)
      - name: trained-models
        persistentVolumeClaim:
          claimName: trained-models-pvc
          readOnly: false
      
      # Training configuration ConfigMap
      - name: training-config
        configMap:
          name: training-config
          optional: false
      
      # Scratch space for checkpoints (EmptyDir with memory backing)
      - name: scratch
        emptyDir:
          medium: "Memory"
          sizeLimit: "512Mi"
    
    volumeMounts:
      # Mount shared datasets at /data (read-only)
      - name: shared-datasets
        mountPath: /data
        readOnly: true
      
      # Mount trained models at /models (read-write)
      - name: trained-models
        mountPath: /models
        readOnly: false
      
      # Mount training config at /config (read-only)
      - name: training-config
        mountPath: /config
        readOnly: true
      
      # Mount scratch space at /scratch (read-write)
      - name: scratch
        mountPath: /scratch
        readOnly: false
  
  timeout: "30m"

